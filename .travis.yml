language: cpp

#branches:
#  only:
#    - master
#    - develop

sudo: false

matrix:
  include:
    - os: linux
      env: CONFIG=Debug
      compiler: gcc
    - os: linux
      env: CONFIG=Debug
      compiler: clang
    - os: linux
      env: CONFIG=Release
      compiler: gcc
    - os: osx
      env: CONFIG=Release
      compiler: clang

before_script:
  - mkdir build
  - cd build
  - cmake --version
  - cmake -D CMAKE_VERBOSE_MAKEFILE=ON -D CMAKE_BUILD_TYPE=${CONFIG} ../src

script:
  - make
  - ./bin/findseed_test

after_success:
  - cd ..
  - mkdir mkseed
  - cp {LICENSE, NEWS.md, README.md} ./mkseed/
  - cp ./build/bin/findseed ./mkseed/
  - tar -czvf mkseed_${os}_${compiler}.tar.gz mkseed

deploy:
  provider: releases
  api_key: "GITHUB OAUTH TOKEN"
  file: mkseed_${os}_${compiler}.tar.gz
  skip_cleanup: true
  on:
    tags: true
  condition: "$CONFIG = Release"
